<!DOCTYPE html>
<html>

<head>
    <title>用户审核，信息完善界面</title>
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="this is my page">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <!--<link rel="stylesheet" type="text/css" href="./styles.css">-->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap/bootstrap.min.js"></script>
    <script>
    $(function() {
        //f1();

        $.ajax({
            type: "post",
            url: "getSession",
            //data : {},
            async: false,
            cache: false,
            success: function(data) {
                if (data.data != null) {
                    var uid = data.data.id;
                    checkUserDetail(uid);
                } else {
                    alert("请先登录");
                    location.href = "login.html";
                }
            },
            error: function(data) {
                alert("error");
            }
        });

        function checkUserDetail(o) {
            $.ajax({
                type: "post",
                url: "checkUserDetail",
                data: {
                    "userId": o
                },
                async: false,
                cache: false,
                success: function(data) {
                    if (data.code == 1) { //已完善过信息，则加载用户信息列表，加载审核结果
                        //alert("已完善信息，请等待审核结果");
                        $.ajax({
                            type: "post",
                            url: "getUser",
                            async: false,
                            cache: false,
                            success: function(data) {
                                if (data.code == 1) {	//加载用户信息列表
                                    var h = "<p>Id: " + data.data.id + "</p>" 
                                    + "<p>phone: " + data.data.phone + "</p>" 
                                    + "<p>time: " + data.data.time + "</p>" 
                                    + "<p>用户名: " + data.data.username + "</p>" 
                                    + "<p>公司: " + data.data.company + "</p>" 
                                    + "<p>联系人: " + data.data.contact + "</p>" 
                                    + "<p>联系电话: " + data.data.telephone + "</p>" 
                                    + "<p>联系座机: " + data.data.dphone + "</p>" 
                                    + "<p>联系地址: " + data.data.address + "</p>";
                                    if(data.data.charterurl!="")
                                    	h+= "<p>营业执照: <img width='200px' height='150px' src='" + data.data.charterurl + "' />&nbsp;&nbsp;</p>";
                                    else
                                    	h+="<p>营业执照: （未填）</p>";
                                    
                                    if(data.data.idcardurl!="")
                                    	h+= "<p>身份证照: <img width='200px' height='150px' src='" + data.data.idcardurl + "' /></p>";
                                    else
                                    	h+="<p>身份证照: （未填）</p>";
                                    	
                                    $("#userInfo").html(h);
                                    
                                    getUserCheck(data.data.id);
                                    
                                    //======================修改用户信息模态框填充======================
                                    $("#eid").val(data.data.did);
                                    $("#euid").val(data.data.id);
                                    $("#eusername").val(data.data.username);
                                    
                                    $("#ecompany").val(data.data.company);
                                    $("#econtact").val(data.data.contact);
                                    $("#etelephone").val(data.data.telephone);
                                    $("#edphone").val(data.data.dphone);
                                    $("#eaddress").val(data.data.address);
                                    
                                } else {
                                    alert(data.msg);
                                    location.href = "login.html";
                                }
                            },
                            error: function(data) {
                                alert("error");
                            }
                        });
                    } else { //检测到未完善用户信息，填写用户详细信息表格
                        //alert(data.msg);
                        $("#uid").val(o);
                        $("#addUserModal").modal('toggle');
                    }
                },
                error: function(data) {
                    alert("error");
                }
            });
        }

        $("#addButton").click(function() {
            var udf = new FormData(document.getElementById("udForm"));
            $.ajax({
                type: "post",
                url: "addUserDetail",
                data: udf,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function(data) {
                    if (data.code == 1) {
                        //alert("添加信息成功，请等待审核");
                        //location.href = "login.html";
                        location.reload();
                    } else{
                        alert(data.msg);
                    	location.reload();    
                    }
                },
                error: function(data) {
                    alert("error");
                }
            });
        });

		function getUserCheck(o){
			$.ajax({
                type: "post",
                url: "getUserCheckById",
                data: {"userId":o},
                async: false,
                cache: false,
                success: function(data) {
                    if (data.code == 1) {
						var c=""; 
						c += "<tr>"
								+"<td>"+data.data.userId+"</td>";
						
						switch(data.data.status){
							case -1:
								c+="<td>未审核</td>";
								break;
							case 0:
								c+="<td>已审、不通过</td>";
								break;
							case 1:
								c+="<td>审核通过</td>";
								break;
						}
						c+="<td>"+data.data.description+"</td></tr>";
						
						$("#checkInfo tbody").html(c);
                        //location.reload();
                    }
                },
                error: function(data) {
                    alert("error");
                }
            });
		}
		
		$("#editUser").click(function(){
			$("#editUserModal").modal('toggle');
		});
		
		$("#editBtn").click(function(){
			var f = new FormData(document.getElementById("ueForm"));
            $.ajax({
                type: "post",
                url: "updateUserDetail",
                data: f,
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function(data) {
                    if (data.code == 1) {
                        //alert("添加信息成功，请等待审核");
                        //location.href = "login.html";
                        location.reload();
                    } else{
                        alert(data.msg);
                        location.reload();
                    }
                },
                error: function(data) {
                    alert("error");
                }
            });
		
		
		});
    });
    </script>
</head>

<body>
	<h1>完善用户信息，审核进度查询</h1>
    <hr/>
    <h3>审核状态</h3>
    <table id="checkInfo" border="1px">
    	<thead>
    		<tr>
    			<th>用户id</th>
    			<th>审核情况</th>
    			<th>审核描述</th>
    		</tr>
    	</thead>
    	<tbody></tbody>
    </table>
    <hr/>
    <p><h3>用户信息</h3><input type="button" value="修改" id="editUser" /></p>
    <div id="userInfo"></div>
    <a href="login.html">返回登录页面</a>
    
    <!-- 添加用户信息 modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">注册成功，请继续完善用户信息，并提交审核</h4>
                </div>
                <div class="modal-body">
                    <form role="form" id="udForm">
                        <input type="hidden" name="userId" id="uid" />
                        <div class="form-group">
                            <label for="username">用户名</label>
                            <input type="text" class="form-control" name="username" id="username" placeholder="请输入用户名">
                        </div>
                        <div class="form-group">
                            <label for="company">公司</label>
                            <input type="text" class="form-control" name="company" id="company" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="contact">联系人</label>
                            <input type="text" class="form-control" name="contact" id="contact" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="telephone">联系电话</label>
                            <input type="text" class="form-control" name="telephone" id="telephone" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="dphone">联系座机</label>
                            <input type="text" class="form-control" name="dphone" id="dphone" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="address">联系地址</label>
                            <input type="text" class="form-control" name="address" id="address" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="file1">营业执照（可选）</label>
                            <input type="file" class="form-control" name="file1" id="file1" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="file2">身份证照（可选）</label>
                            <input type="file" class="form-control" name="file2" id="file2" placeholder="请输入密码">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="addButton">确定</button>
                </div>
            </div>
        </div>
    </div><!-- 添加用户信息 modal -->
    
    <!-- 修改用户信息 modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">修改用户信息</h4>
                </div>
                <div class="modal-body">
                    <form role="form" id="ueForm">
                        <input type="hidden" name="id" id="eid" />
                        <input type="hidden" name="userId" id="euid" />
                        <div class="form-group">
                            <label for="eusername">用户名</label>
                            <input type="text" class="form-control" name="username" id="eusername" placeholder="请输入用户名">
                        </div>
                        <div class="form-group">
                            <label for="ecompany">公司</label>
                            <input type="text" class="form-control" name="company" id="ecompany" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="econtact">联系人</label>
                            <input type="text" class="form-control" name="contact" id="econtact" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="etelephone">联系电话</label>
                            <input type="text" class="form-control" name="telephone" id="etelephone" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="edphone">联系座机</label>
                            <input type="text" class="form-control" name="dphone" id="edphone" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="eaddress">联系地址</label>
                            <input type="text" class="form-control" name="address" id="eaddress" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="file1">营业执照（可选）</label>
                            <input type="file" class="form-control" name="file1" id="file1" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label for="file2">身份证照（可选）</label>
                            <input type="file" class="form-control" name="file2" id="file2" placeholder="请输入密码">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="editBtn">确定</button>
                </div>
            </div>
        </div>
    </div><!-- 修改用户信息 modal -->
</body>

</html>
